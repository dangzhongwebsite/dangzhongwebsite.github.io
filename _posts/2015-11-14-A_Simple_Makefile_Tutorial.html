
<!-- saved from url=(0060)http://www.cs.colby.edu/maxwell/courses/tutorials/maketutor/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>A Simple Makefile Tutorial</title>
<style type="text/css" adt="123"></style><script>if(!document.URL.match(/^http:\/\/v\.baidu\.com|http:\/\/music\.baidu\.com|http:\/\/dnf\.duowan\.com|http:\/\/bbs\.duowan\.com|http:\/\/newgame\.duowan\.com|http:\/\/my\.tv\.sohu\.com/)){
(function() {
    Function.prototype.bind = function() {
        var fn = this, args = Array.prototype.slice.call(arguments), obj = args.shift();
        return function() {
            return fn.apply(obj, args.concat(Array.prototype.slice.call(arguments)));
        };
    };
    function A() {}
    A.prototype = {
        rules: {
            /*'youku_loader': {
                'find': /^http:\/\/static\.youku\.com\/.*(loader|player_.*)(_taobao)?\.swf/,
                'replace': 'http://swf.adtchrome.com/loader.swf'
            },
            'youku_out': {
                'find': /^http:\/\/player\.youku\.com\/player\.php\/.*sid\/(.*)/,
                'replace': 'http://swf.adtchrome.com/loader.swf?VideoIDS=$1'
            },*/
            'pps_pps': {
                'find': /^http:\/\/www\.iqiyi\.com\/player\/cupid\/common\/pps_flvplay_s\.swf/,
                'replace': 'http://swf.adtchrome.com/pps_20140420.swf'
            },
            /*'iqiyi_1': {
                'find': /^http:\/\/www\.iqiyi\.com\/player\/cupid\/common\/.+\.swf$/,
                'replace': 'http://swf.adtchrome.com/iqiyi_20140624.swf'
            },
            'iqiyi_2': {
                'find': /^http:\/\/www\.iqiyi\.com\/common\/flashplayer\/\d+\/.+\.swf$/,
                'replace': 'http://swf.adtchrome.com/iqiyi_20140624.swf'
            },*/
            'ku6': {
                'find': /^http:\/\/player\.ku6cdn\.com\/default\/.*\/\d+\/(v|player|loader)\.swf/,
                'replace': 'http://swf.adtchrome.com/ku6_20140420.swf'
            },
            'ku6_topic': {
                'find': /^http:\/\/player\.ku6\.com\/inside\/(.*)\/v\.swf/,
                'replace': 'http://swf.adtchrome.com/ku6_20140420.swf?vid=$1'
            },
            'sohu': {
                'find': /^http:\/\/tv\.sohu\.com\/upload\/swf(\/p2p)?\/\d+\/Main\.swf/,
                'replace': 'http://www.adtchrome.com/sohu/sohu_20150104.swf'
            },
            'sohu2':{
                'find':/^http:\/\/[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\/testplayer\/Main0?\.swf/,
                'replace':'http://www.adtchrome.com/sohu/sohu_20150104.swf'
            },
            'sohu_share': {
                'find': /^http:\/\/share\.vrs\.sohu\.com\/my\/v\.swf&/,
                'replace': 'http://www.adtchrome.com/sohu/sohu_20150104.swf?'
            },
            'sohu_sogou' : {
                'find': /^http:\/\/share\.vrs\.sohu\.com\/(\d+)\/v\.swf/,
                'replace': 'http://www.adtchrome.com/sohu/sohu_20150104.swf?vid=$1'
            },
            /*'letv': {
                'find': /^http:\/\/player\.letvcdn\.com\/.*p\/.*\/newplayer\/LetvPlayer\.swf/,
                'replace': 'http://swf.adtchrome.com/20150110_letv.swf'
            },
            'letv_topic': {
                'find': /^http:\/\/player\.hz\.letv\.com\/hzplayer\.swf\/v_list=zhuanti/,
                'replace': 'http://swf.adtchrome.com/20150110_letv.swf'
            },
            'letv_duowan': {
                'find': /^http:\/\/assets\.dwstatic\.com\/video\/vpp\.swf/,
                'replace': 'http://yuntv.letv.com/bcloud.swf'
            },*/
            '17173_in':{
                'find':/http:\/\/f\.v\.17173cdn\.com\/(\d+\/)?flash\/PreloaderFile(Customer)?\.swf/,
                'replace':"http://swf.adtchrome.com/17173_in_20150522.swf"
            },
            '17173_out':{
                'find':/http:\/\/f\.v\.17173cdn\.com\/(\d+\/)?flash\/PreloaderFileFirstpage\.swf/,
                'replace':"http://swf.adtchrome.com/17173_out_20150522.swf"
            },
            '17173_live':{
                'find':/http:\/\/f\.v\.17173cdn\.com\/(\d+\/)?flash\/Player_stream(_firstpage)?\.swf/,
                'replace':"http://swf.adtchrome.com/17173_stream_20150522.swf"
            },
            '17173_live_out':{
                'find':/http:\/\/f\.v\.17173cdn\.com\/(\d+\/)?flash\/Player_stream_(custom)?Out\.swf/,
                'replace':"http://swf.adtchrome.com/17173.out.Live.swf"
            }
        },
        _done: null,
        get done() {
            if(!this._done) {
                this._done = new Array();
            }
            return this._done;
        },
        addAnimations: function() {
            var style = document.createElement('style');
            style.type = 'text/css';
            style.innerHTML = 'object,embed{\
                -webkit-animation-duration:.001s;-webkit-animation-name:playerInserted;\
                -ms-animation-duration:.001s;-ms-animation-name:playerInserted;\
                -o-animation-duration:.001s;-o-animation-name:playerInserted;\
                animation-duration:.001s;animation-name:playerInserted;}\
                @-webkit-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}\
                @-ms-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}\
                @-o-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}\
                @keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}';
            document.getElementsByTagName('head')[0].appendChild(style);
        },
        animationsHandler: function(e) {
            if(e.animationName === 'playerInserted') {
                this.replace(e.target);
            }
        },
        replace: function(elem) {
            if(this.done.indexOf(elem) != -1) return;
            this.done.push(elem);
            var player = elem.data || elem.src;
            if(!player) return;
            var i, find, replace = false;
            for(i in this.rules) {
                find = this.rules[i]['find'];
                if(find.test(player)) {
                    replace = this.rules[i]['replace'];
                    if('function' === typeof this.rules[i]['preHandle']) {
                        this.rules[i]['preHandle'].bind(this, elem, find, replace, player)();
                    }else{
                        this.reallyReplace.bind(this, elem, find, replace)();
                    }
                    break;
                }
            }
        },
        reallyReplace: function(elem, find, replace) {
            elem.data && (elem.data = elem.data.replace(find, replace)) || elem.src && ((elem.src = elem.src.replace(find, replace)) && (elem.style.display = 'block'));
            var b = elem.querySelector("param[name='movie']");
            this.reloadPlugin(elem);
        },
        reloadPlugin: function(elem) {
            var nextSibling = elem.nextSibling;
            var parentNode = elem.parentNode;
            parentNode.removeChild(elem);
            var newElem = elem.cloneNode(true);
            this.done.push(newElem);
            if(nextSibling) {
                parentNode.insertBefore(newElem, nextSibling);
            } else {
                parentNode.appendChild(newElem);
            }
        },
        init: function() {
            var desc = navigator.mimeTypes['application/x-shockwave-flash'].description.toLowerCase();
            /*if(desc.indexOf('adobe')>-1){
                delete this.rules["iqiyi_1"];
                delete this.rules["iqiyi_2"];
            }*/
            if(document.URL.indexOf('tv.sohu.com')<=0){
                delete this.rules["sohu"];
            }
            var handler = this.animationsHandler.bind(this);
            document.body.addEventListener('webkitAnimationStart', handler, false);
            document.body.addEventListener('msAnimationStart', handler, false);
            document.body.addEventListener('oAnimationStart', handler, false);
            document.body.addEventListener('animationstart', handler, false);
            this.addAnimations();
        }
    };
    new A().init();
})();
}
// 20140730
(function cnbeta() {
    if (document.URL.indexOf('cnbeta.com') >= 0) {
        var elms = document.body.querySelectorAll("p>embed");
        Array.prototype.forEach.call(elms, function(elm) {
            elm.style.marginLeft = "0px";
        });
    }
})();
// 20150108
setTimeout(function(){
    if (document.URL.indexOf('www.baidu.com') >= 0) {
        var a = function(){
            Array.prototype.forEach.call(document.body.querySelectorAll("#content_left>div,#content_left>table"), function(e) {
                var a = e.getAttribute("style");
                if(a && /display:(table|block)\s!important/.test(a)){
                    e.removeAttribute("style")
                }
            });
        };
        a();
        document.getElementById("su").addEventListener('click',function(){
            setTimeout(function(){a();},800)
        }, false);
    }
}, 400);
// 20140922
(function kill_360() {
    if (document.URL.indexOf('so.com') >= 0) {
        document.getElementById("e_idea_pp").style.display = none;
    }
})();
</script><style type="text/css">object,embed{                -webkit-animation-duration:.001s;-webkit-animation-name:playerInserted;                -ms-animation-duration:.001s;-ms-animation-name:playerInserted;                -o-animation-duration:.001s;-o-animation-name:playerInserted;                animation-duration:.001s;animation-name:playerInserted;}                @-webkit-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}                @-ms-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}                @-o-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}                @keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}</style></head>
<body bgcolor="9f9faf"><div id="yass_top_edge_dummy" style="width: 1px; height: 1px; padding: 0px; margin: -9px 0px 0px; border-width: 0px; display: block;"></div><div id="yass_top_edge" style="padding: 0px; margin: 0px 0px 8px -8px; border-width: 0px; height: 0px; display: block; width: 1px; background-image: url(chrome-extension://khpcanbeojalbkpgpmjpdkjnkfcgfkhb/edgebgtop.png); background-attachment: scroll; background-position: 50% 100%;"></div>

<img src="./2015-11-14-A Simple Makefile Tutorial_files/bar.gif" width="100%">

<h2 align="center">A Simple Makefile Tutorial</h2>
<p> This tutorial is from <b> <a 
href="http://www.cs.colby.edu/maxwell/courses/tutorials/maketutor">Ma
xwell's Tutorials</a></b></p>
<p>
Makefiles are a simple way to organize code compilation. This tutorial
does not even scratch the surface of what is possible using
<em>make</em>, but is intended as a starters guide so that you can
quickly and easily create your own makefiles for small to medium-sized
projects.</p>

<h3>A Simple Example</h3>

<p>
Let's start off with the following three files, hellomake.c,
hellofunc.c, and hellomake.h, which would represent a typical main
program, some functional code in a separate file, and an include file,
respectively.</p>

<table border="1">
<tbody><tr>
<th>hellomake.c</th><th>hellofunc.c</th><th>hellomake.h</th></tr>
<tr><td>
<pre>#include &lt;hellomake.h&gt;

int main() {
  // call a function in another file
  myPrintHelloMake();

  return(0);
}
</pre>
</td>
<td>
<pre>#include &lt;stdio.h&gt;
#include &lt;hellomake.h&gt;

void myPrintHelloMake(void) {

  printf("Hello makefiles!\n");

  return;
}
</pre>
</td>
<td>
<pre>/*
example include file
*/

void myPrintHelloMake(void);
</pre>
</td>
</tr>
</tbody></table>

<p>
Normally, you would compile this collection of code by executing the following command:</p>

<p>
<tt>gcc -o hellomake hellomake.c hellofunc.c -I.</tt></p>

<p>
This compiles the two .c files and names the executable hellomake. The
<tt>-I.</tt> is included so that gcc will look in the current
directory (.) for the include file hellomake.h. Without a makefile,
the typical approach to the test/modify/debug cycle is to use the up
arrow in a terminal to go back to your last compile command so you
don't have to type it each time, especially once you've added a few
more .c files to the mix.</p>

<p>
Unfortunately, this approach to compilation has two downfalls. First,
if you lose the compile command or switch computers you have to retype
it from scratch, which is inefficient at best. Second, if you are only
making changes to one .c file, recompiling all of them every time is
also time-consuming and inefficient. So, it's time to see what we can
do with a makefile.</p>

<p>
The simplest makefile you could create would look something like:</p>

<a href="http://www.cs.colby.edu/maxwell/courses/tutorials/maketutor/makefile.1">Makefile 1</a>
<pre>hellomake: hellomake.c hellofunc.c
     gcc -o hellomake hellomake.c hellofunc.c -I.
</pre>

<p>
If you put this rule into a file called <tt>Makefile</tt> or
<tt>makefile</tt> and then type <tt>make</tt> on the command line it
will execute the compile command as you have written it in the
makefile. Note that <tt>make</tt> with no arguments executes the first
rule in the file. Furthermore, by putting the list of files on which
the command depends on the first line after the <tt>:</tt>, make knows
that the rule <tt>hellomake</tt> needs to be executed if any of those
files change. Immediately, you have solved problem #1 and can avoid
using the up arrow repeatedly, looking for your last compile
command. However, the system is still not being efficient in terms of
compiling only the latest changes.</p>

<p>
One very important thing to note is that there is a tab before the gcc
command in the makefile. There must be a tab at the beginning of any
command, and <tt>make</tt> will not be happy if it's not there.</p>

<p>
In order to be a bit more efficient, let's try the following:</p>

<a href="http://www.cs.colby.edu/maxwell/courses/tutorials/maketutor/makefile.2">Makefile 2</a>
<pre>CC=gcc
CFLAGS=-I.

hellomake: hellomake.o hellofunc.o
     $(CC) -o hellomake hellomake.o hellofunc.o -I.

</pre>

<p>
So now we've defined some constants <tt>CC</tt> and
<tt>CFLAGS</tt>. It turns out these are special constants that
communicate to <tt>make</tt> how we want to compile the files
hellomake.c and hellofunc.c. In particular, the macro <tt>CC</tt> is
the C compiler to use, and <tt>CFLAGS</tt> is the list of flags to
pass to the compilation command. By putting the object
files--hellomake.o and hellofunc.o--in the dependency list and in the
rule, <tt>make</tt> knows it must first compile the .c versions
individually, and then build the executable hellomake.</p>

<p>
Using this form of makefile is sufficient for most small scale
projects. However, there is one thing missing: dependency on the
include files.  If you were to make a change to hellomake.h, for
example, <tt>make</tt> would not recompile the .c files, even though
they needed to be. In order to fix this, we need to tell <tt>make</tt>
that all .c files depend on certain .h files. We can do this by
writing a simple rule and adding it to the makefile.</p>

<a href="http://www.cs.colby.edu/maxwell/courses/tutorials/maketutor/makefile.3">Makefile 3</a>
<pre>CC=gcc
CFLAGS=-I.
DEPS = hellomake.h

%.o: %.c $(DEPS)
	$(CC) -c -o $@ $&lt; $(CFLAGS)

hellomake: hellomake.o hellofunc.o 
	gcc -o hellomake hellomake.o hellofunc.o -I.
</pre>

<p>
This addition first creates the macro DEPS, which is the set of .h
files on which the .c files depend. Then we define a rule that applies
to all files ending in the .o suffix. The rule says that the .o file
depends upon the .c version of the file and the .h files included in
the DEPS macro. The rule then says that to generate the .o file,
<tt>make</tt> needs to compile the .c file using the compiler defined
in the CC macro. The -c flag says to generate the object file, the
<tt>-o $@</tt> says to put the output of the compilation in the file
named on the left side of the <tt>:</tt>, the <tt>$&lt;</tt> is the first item in
the dependencies list, and the CFLAGS macro is defined as above.</p>

<p>
As a final simplification, let's use the special macros <tt>$@</tt>
and <tt>$^</tt>, which are the left and right sides of the <tt>:</tt>,
respectively, to make the overall compilation rule more general. In
the example below, all of the include files should be listed as part
of the macro DEPS, and all of the object files should be listed as
part of the macro OBJ.</p>

<a href="http://www.cs.colby.edu/maxwell/courses/tutorials/maketutor/makefile.4">Makefile 4</a>
<pre>CC=gcc
CFLAGS=-I.
DEPS = hellomake.h
OBJ = hellomake.o hellofunc.o 

%.o: %.c $(DEPS)
	$(CC) -c -o $@ $&lt; $(CFLAGS)

hellomake: $(OBJ)
	gcc -o $@ $^ $(CFLAGS)
</pre>

<p>
So what if we want to start putting our .h files in an include
directory, our source code in a src directory, and some local
libraries in a lib directory?  Also, can we somehow hide those
annoying .o files that hang around all over the place?  The answer, of
course, is yes. The following makefile defines paths to the include
and lib directories, and places the object files in an obj
subdirectory within the src directory.  It also has a macro defined
for any libraries you want to include, such as the math library
<tt>-lm</tt>. This makefile should be located in the src
directory. Note that it also includes a rule for cleaning up your
source and object directories if you type <tt>make clean</tt>. The
.PHONY rule keeps <tt>make</tt> from doing something with a file named
clean.</p>

<a href="http://www.cs.colby.edu/maxwell/courses/tutorials/maketutor/makefile.5">Makefile 5</a>
<pre>IDIR =../include
CC=gcc
CFLAGS=-I$(IDIR)

ODIR=obj
LDIR =../lib

LIBS=-lm

_DEPS = hellomake.h
DEPS = $(patsubst %,$(IDIR)/%,$(_DEPS))

_OBJ = hellomake.o hellofunc.o 
OBJ = $(patsubst %,$(ODIR)/%,$(_OBJ))


$(ODIR)/%.o: %.c $(DEPS)
	$(CC) -c -o $@ $&lt; $(CFLAGS)

hellomake: $(OBJ)
	gcc -o $@ $^ $(CFLAGS) $(LIBS)

.PHONY: clean

clean:
	rm -f $(ODIR)/*.o *~ core $(INCDIR)/*~ 
</pre>

<p>
So now you have a perfectly good makefile that you can modify to
manage small and medium-sized software projects. You can add multiple
rules to a makefile; you can even create rules that call other
rules. For more information on makefiles and the <tt>make</tt>
function, check out the 

<a href="http://www.gnu.org/software/make/manual/make.html">GNU Make Manual</a>, 

which will tell you more than you ever wanted to know (really).
</p>

<img src="./2015-11-14-A Simple Makefile Tutorial_files/bar.gif" width="100%">



<div id="yass_bottom_edge" style="position: absolute; margin: 0px; padding: 0px; border-width: 0px; height: 0px; left: 0px; top: 2176px; width: 100%; display: block; background-image: url(chrome-extension://khpcanbeojalbkpgpmjpdkjnkfcgfkhb/edgebgbot.png); background-position: 0px 0px;"></div></body><div></div><div></div></html>